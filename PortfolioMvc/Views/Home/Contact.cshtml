<!-- Contact Section -->
<section id="contact" class="contact section">

    <!-- Section Title -->
    <div class="container section-title" data-aos="fade-up">
        <h2>Contact</h2>
        <p class="hideme">Get in touch with me via phone, WhatsApp, email, or the contact form below.</p>
        <p>Get in touch with me via email, or the contact form below.</p>
    </div>

    <div class="container" data-aos="fade-up" data-aos-delay="100">
        <div class="row gy-4">

            <!-- Contact Info -->
            <div class="col-lg-5">
                <div class="info-wrap">
                    <div class="info-item d-flex" data-aos="fade-up" data-aos-delay="200">
                        <i class="bi bi-geo-alt flex-shrink-0"></i>
                        <div>
                            <h3>Address</h3>
                            <p>Abu Dhabi, United Arab Emirates</p>
                        </div>
                    </div>

                    <div class="info-item d-flex hideme" data-aos="fade-up" data-aos-delay="300">
                        <i class="bi bi-telephone flex-shrink-0"></i>
                        <div>
                            <h3>Call Me</h3>
                            <p><a href="tel:+971552120140">+971 55 212 0140</a></p>
                        </div>
                    </div>

                    <div class="info-item d-flex hideme" data-aos="fade-up" data-aos-delay="400">
                        <i class="bi bi-whatsapp flex-shrink-0"></i>
                        <div>
                            <h3>WhatsApp</h3>
                            <p><a href="https://wa.me/971552120140" target="_blank">+971 55 212 0140</a></p>
                        </div>
                    </div>

                    <div class="info-item d-flex" data-aos="fade-up" data-aos-delay="500">
                        <i class="bi bi-envelope flex-shrink-0"></i>
                        <div>
                            <h3>Email Me</h3>
                            <p><a href="mailto:ruzzaayoub@gmail.com">ruzzaayoub@gmail.com</a></p>
                        </div>
                    </div>

                    <iframe style="border:0; width:100%; height:270px;" class="hideme" allowfullscreen="" loading="lazy"
                            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3609.162248164285!2d54.37159201501913!3d24.45388498406471!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3e5f434f3edc15a7%3A0x5e78bdbbb5f8c9f8!2sAbu%20Dhabi%2C%20UAE!5e0!3m2!1sen!2sus!4v1697090000000!5m2!1sen!2sus">
                    </iframe>
                </div>
            </div>

            <!-- Contact Form -->
            <div class="col-lg-7">
                <form id="contactForm" method="post" class="php-email-form" data-aos="fade-up" data-aos-delay="200" novalidate>
                    @Html.AntiForgeryToken()
                    <!-- Loading Message -->
                    <div class="loading d-none">
                        <i class="bi bi-hourglass-split"></i> Sending your message...
                    </div>
                    
                    <!-- Error Message -->
                    <div class="error-message d-none"></div>
                    
                    <!-- Success Message -->
                    <div class="sent-message d-none">
                        <i class="bi bi-check-circle"></i> Your message has been sent. Thank you!
                    </div>

                    <div class="row gy-4">
                        <div class="col-md-6">
                            <label for="name-field" class="pb-2">
                                Your Name <span class="text-danger">*</span>
                            </label>
                            <input type="text" 
                                   name="Name" 
                                   id="name-field" 
                                   class="form-control" 
                                   required 
                                   aria-required="true"
                                   aria-describedby="name-error"
                                   placeholder="Enter your full name">
                            <span class="field-validation-error text-danger small d-none" id="name-error" role="alert"></span>
                        </div>

                        <div class="col-md-6">
                            <label for="email-field" class="pb-2">
                                Your Email <span class="text-danger">*</span>
                            </label>
                            <input type="email" 
                                   name="Email" 
                                   id="email-field" 
                                   class="form-control" 
                                   required 
                                   aria-required="true"
                                   aria-describedby="email-error"
                                   placeholder="your.email@example.com">
                            <span class="field-validation-error text-danger small d-none" id="email-error" role="alert"></span>
                        </div>

                        <div class="col-md-12">
                            <label for="subject-field" class="pb-2">
                                Subject <span class="text-danger">*</span>
                            </label>
                            <input type="text" 
                                   name="Subject" 
                                   id="subject-field" 
                                   class="form-control" 
                                   required 
                                   aria-required="true"
                                   aria-describedby="subject-error"
                                   placeholder="What is this regarding?">
                            <span class="field-validation-error text-danger small d-none" id="subject-error" role="alert"></span>
                        </div>

                        <div class="col-md-12">
                            <label for="message-field" class="pb-2">
                                Message <span class="text-danger">*</span>
                            </label>
                            <textarea name="Message" 
                                      id="message-field" 
                                      rows="8" 
                                      class="form-control" 
                                      required 
                                      aria-required="true"
                                      aria-describedby="message-error"
                                      placeholder="Tell me about your project or inquiry..."></textarea>
                            <span class="field-validation-error text-danger small d-none" id="message-error" role="alert"></span>
                        </div>

                        <div class="col-md-12 text-center">
                            <button type="submit" class="btn-submit" aria-label="Send message">
                                <span class="btn-text">
                                    <i class="bi bi-send me-2"></i>Send Message
                                </span>
                                <span class="btn-loading d-none">
                                    <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                                    Sending...
                                </span>
                            </button>
                        </div>

                    </div>
                </form>
            </div>

        </div>
    </div>

</section>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
<script>
    $(document).ready(function () {
        const $form = $('#contactForm');
        const $submitBtn = $form.find('button[type="submit"]');
        const $btnText = $submitBtn.find('.btn-text');
        const $btnLoading = $submitBtn.find('.btn-loading');
        const $loading = $form.find('.loading');
        const $errorMsg = $form.find('.error-message');
        const $successMsg = $form.find('.sent-message');

        // Real-time validation feedback
        $form.find('input, textarea').on('blur', function() {
            const $field = $(this);
            const fieldName = $field.attr('name');
            const $errorSpan = $form.find(`#${fieldName.toLowerCase()}-error`);
            
            if ($field.val().trim() === '') {
                $field.addClass('is-invalid');
                $errorSpan.removeClass('d-none').text('This field is required.');
            } else if ($field.attr('type') === 'email' && !isValidEmail($field.val())) {
                $field.addClass('is-invalid');
                $errorSpan.removeClass('d-none').text('Please enter a valid email address.');
            } else {
                $field.removeClass('is-invalid').addClass('is-valid');
                $errorSpan.addClass('d-none');
            }
        });

        function isValidEmail(email) {
            // Simple email validation
            const atSymbol = '@@';
            const atIndex = email.indexOf(atSymbol);
            const dotIndex = email.lastIndexOf('.');
            return atIndex > 0 && dotIndex > atIndex && dotIndex < email.length - 1;
        }

        $form.on('submit', function (e) {
            e.preventDefault();
            
            // Hide previous messages
            $errorMsg.addClass('d-none');
            $successMsg.addClass('d-none');
            $loading.removeClass('d-none');
            
            // Validate form
            if (!$form[0].checkValidity()) {
                $form[0].reportValidity();
                $loading.addClass('d-none');
                return false;
            }

            // Show loading state
            $submitBtn.prop('disabled', true);
            $btnText.addClass('d-none');
            $btnLoading.removeClass('d-none');

            $.ajax({
                url: '@Url.Action("Contact", "Home")',
                type: 'POST',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                },
                data: $form.serialize(),
                success: function (response) {
                    $loading.addClass('d-none');
                    
                    // Handle JSON response
                    if (typeof response === 'object' && response.success) {
                        // Success
                        $form[0].reset();
                        $form.find('.is-valid, .is-invalid').removeClass('is-valid is-invalid');
                        $successMsg.removeClass('d-none');
                        
                        // Re-enable button
                        $submitBtn.prop('disabled', false);
                        $btnText.removeClass('d-none');
                        $btnLoading.addClass('d-none');
                        
                        // Scroll to success message
                        $('html, body').animate({
                            scrollTop: $successMsg.offset().top - 100
                        }, 500);

                        // Show success notification
                        Swal.fire({
                            icon: 'success',
                            title: 'Message Sent!',
                            text: 'Thank you for contacting me. I will get back to you soon.',
                            confirmButtonColor: '#34b7a7',
                            confirmButtonText: 'OK',
                            timer: 5000,
                            timerProgressBar: true
                        });
                    } else {
                        // HTML response with validation errors
                        if ($(response).find('.field-validation-error').length > 0) {
                            $errorMsg.removeClass('d-none').html('Please correct the errors below.');
                            $form.html($(response).find('#contactForm').html());
                        }
                    }
                },
                error: function (xhr) {
                    $loading.addClass('d-none');
                    
                    let errorMessage = 'There was an error sending your message. Please try again.';
                    
                    if (xhr.responseJSON && xhr.responseJSON.message) {
                        errorMessage = xhr.responseJSON.message;
                    } else if (xhr.status === 400) {
                        errorMessage = 'Please check your form and correct any errors.';
                    } else if (xhr.status === 0) {
                        errorMessage = 'Network error. Please check your connection.';
                    } else if (xhr.status >= 500) {
                        errorMessage = 'Server error. Please try again later.';
                    }
                    
                    $errorMsg.removeClass('d-none').html(`<i class="bi bi-exclamation-triangle me-2"></i>${errorMessage}`);
                    
                    // Re-enable button
                    $submitBtn.prop('disabled', false);
                    $btnText.removeClass('d-none');
                    $btnLoading.addClass('d-none');
                    
                    // Scroll to error message
                    $('html, body').animate({
                        scrollTop: $errorMsg.offset().top - 100
                    }, 500);
                }
            });
        });
    });
</script>

